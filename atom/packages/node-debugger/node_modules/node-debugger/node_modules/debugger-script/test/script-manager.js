var test = require('tape')
  , rewire = require('rewire')
  , ScriptManager = rewire('../lib/script-manager')
  , EV = require('events').EventEmitter
  , sinon = require('sinon');

test('when client emit change event', function(t) {
  t.plan(1);

  var clientStub = new EV()
    , protocol = new EV()
    , ScriptMock = {};

  ScriptMock.listAll = sinon.stub().returns(ScriptMock),
  ScriptMock.then = sinon.stub().callsArgWith(0, [{
    id: '1'
  }])

  ScriptManager.__set__('ScriptGen', sinon.stub().returns(ScriptMock));

  var manager = new ScriptManager(clientStub);

  manager.on('change', function(scripts) {
    t.ok(true, 'should fire change event');
  });

  clientStub._connected = true;
  clientStub.emit('change');
});
